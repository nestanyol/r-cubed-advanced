# Running efficient statistical analyses {#sec-statistical-analyses}

{{< include ../includes/_wip.qmd >}}

```{r setup}
#| include: false
library(tidyverse)
load(here::here("data/lipidomics.rda"))
```

::: {.callout-note appearance="minimal" collapse="true"}
## Instructor note

Before beginning, get them to recall what they remember of the previous
session, either with something like Mentimeter or verbally. Preferably
something like Mentimeter because it allows everyone to participate, not
just the ones who are more comfortable being vocal to the whole group.
:::

TODO: intro here

## Learning objectives

The overall objective for this session is to:

1.  Describe the basic framework underlying most statistical analyses
    and use R to generate statistical results using this framework.

More specific objectives are to:

1.  Describe the general "workflow" and steps involved in stating the
    research question, constructing a model to help answer the question,
    preparing the data to match the requirements of the model, fitting
    it to the data, and finally extracting the results from the fitted
    model.
2.  Categorize the model definition step as a distinct, theory-driven
    step, separate from the data, and use `{parsnip}` functions to help
    with defining your model.
3.  Identify various data transformation techniques and evaluate which
    are good options given the data. Use functions in the `{recipes}`
    package to apply these transformations to your data.
4.  Recall principles of functional programming and apply them to
    running statistical analyses by using the `{purrr}` package.
5.  Use the `{broom}` package to extract the model results to later
    present them in tabular (with `knitr::kable()`) or graphical format
    (with `{ggplot2}`).
6.  Describe what a resampling technique is, the types available, and
    why it can help estimate the variability of model results. Apply
    functions from `{rsample}` to use these techniques.
7.  Continue applying the concepts and functions used from the previous
    sessions.

Specific "anti"-objectives:

-   Will **not** know how to choose and apply the appropriate
    statistical model or test, nor understand any statistical theory,
    nor interpret the statistical results correctly, nor determine the
    relevant data transformations for the statistical approach. What we
    show, we show *only as demonstration purposes only*, they could be
    entirely wrong in how to do them correctly if an expert were to
    review them.

## Exercise: What does a "model" mean?

> Time: \~8 minutes.

In science and especially statistics, we talk a lot about "models". But
what does model actually mean? What different types of definitions can
you think of? Is there a different understanding of model in statistics
compared to other areas?

1.  Take 1 minute to think about your understanding of a model.
2.  Then, over the next 4 minutes, discuss with your neighbour about the
    meaning of "model" and see if you can come to a shared
    understanding.
3.  Finally, over the next 3 minutes, we will share all together what a
    model is in the context of data analysis.

## Theory and "workflow" on statistical modeling

-   theory behind running analyses

    -   caveats: Each statistical method requires knowledge on it and on
        the underlying data, which we are **not** able to cover in this
        course, as that is highly specific to the problem and field of
        research.
-   why tidymodels

## Exercise: How would you define a linear regression with parsnip?

> Time: \~10 minutes.

Using [parsnip's "Examples"
vignette](https://parsnip.tidymodels.org/articles/Examples.html) as well
as the code we wrote for the logistic regression above as a template,
write `{parsnip}` code that would define a simple (an engine of`"lm"`)
linear regression model. Begin by making a new Markdown header and code
chunk at the bottom of the `doc/lesson.Rmd` file, like listed below:

    ## Exercises
    ### Linear regression model definition

    ```{{r}}

    ```

After writing the code, run `r run_styler_text`. We will eventually
delete these exercise text in the R Markdown file, but for now, commit
the changes to the Git history.

```{r solution-define-linear-reg-model}
#| eval: false
#| code-fold: true
#| code-summary: "**Click for the solution**. Only click if you are struggling or are out of time."
linear_reg_specs <- linear_reg() %>% 
  set_engine("lm")
```

## Exercise: Which transformations make the most sense?

> Time: \~15 minutes.

Look at the list of `step_*` functions below and use the `?` or F1
(while having the cursor on the function name) to access the help
documentation. Consider the metabolite data in the `lipidomics` dataset.
Which of these transformations might you use?

```{r}
#| eval: false
recipes::step_log()
recipes::step_scale()
recipes::step_normalize()
recipes::step_center()
recipes::step_sqrt()
```

-   With your neighbour (or group), justify which `step_` transformation
    you might use for the numeric metabolite data.
-   In the last 2 minutes of the exercise, we will all share our
    thoughts.

::: callout-note
The `step_` function we use in the text of this website in later
sections may be different from what you decide on in your group and in
the class as a whole. There isn't strictly a "right" answer here, since
it would ultimately require domain expertise in both lipidomic
quantification and statistical analysis of -omic data. But we ultimate
need to show and use *something* in the text.
:::

## Summary
